"use strict";(self["webpackChunkpaq"]=self["webpackChunkpaq"]||[]).push([[211],{3560:function(e,s,a){a.d(s,{L:function(){return o}});a(7658);var t=a(4870),l=a(5543),r=a(4850);const o=(0,l.Q_)("user",(()=>{const e=(0,t.iH)(null),s=(0,t.iH)([]),a=(0,t.iH)(null),l=async()=>{try{e.value=null;const a=await r.iJ.get("/api/users/agencyUsers",{showLoader:!0});return 200===a.status?(s.value=a.data,{success:!0}):{success:!1}}catch(a){return e.value=a instanceof Error?a:new Error("Failed to load users"),console.log(a),{success:!1}}},o=async a=>{try{e.value=null;const t=await r.iJ.post("/api/auth/platform/register-user",a,{showLoader:!0});if(201===t.status){const e=t.data;return e.roles=["admin"],s.value.push(e),{success:!0}}return{success:!1}}catch(t){return Array.isArray(t)?(e.value=t,{success:!1}):(e.value=t instanceof Error?t:new Error("Failed to add user"),{success:!1})}},n=async a=>{try{e.value=null;const t=await r.iJ.delete(`/api/users/${a.email}`,{showLoader:!0});if(204===t.status){const e=s.value.findIndex((e=>e.id===a.id));return-1!==e&&s.value.splice(e,1),{success:!0}}return{success:!1}}catch(t){return e.value=t instanceof Error?t:new Error("Failed to delete user"),{success:!1}}},c=async()=>{try{e.value=null;const s=await r.iJ.get("/api/users/profile",{showLoader:!0});return 200===s.status?(a.value=s.data,{success:!0}):{success:!1}}catch(s){return e.value=s instanceof Error?s:new Error("Failed to fetch profile details"),console.log(s),{success:!1}}},u=async s=>{try{e.value=null;const a=await r.iJ.post("/api/users/changePassword",s,{showLoader:!0});return 204===a.status?{success:!0}:{success:!1}}catch(a){return e.value=a instanceof Error?a:"Failed to change the password",{success:!1}}},i=async s=>{try{e.value=null;const a=await r.JQ.post("/v1/payment-platform/receipts/createreceiptonly",s,{showLoader:!0,keyRequest:!0});return 201===a.status?{success:!0}:{success:!1}}catch(a){return Array.isArray(a)?(e.value=a,{success:!1}):(e.value=a instanceof Error?a:new Error("Failed to request receipt"),{success:!1})}};return{error:e,users:s,profile:a,loadUsers:l,addNewUser:o,deleteUser:n,fetchProfile:c,changePassword:u,requestReceipt:i}}))},211:function(e,s,a){a.r(s),a.d(s,{default:function(){return M}});var t=a(3396),l=a(4870),r=a(7139),o=a(9242),n=a(7920),c=a(8890);const u={class:"card border-0 box-shadow border-radius-10 mb-4"},i={class:"card-body p-4"},d={class:"all-table scroll-bar h-624 mb-5"},m={class:"table align-middle"},p={class:"ps-0"},f={class:"text-start text-dark"},v={class:"d-block text-dark"},b={class:"d-block text-dark"},w={class:"d-block text-dark"},h={class:"d-block text-dark"},_={class:"text-end text-center"},g={class:"dropdown action-opt"},y={class:"btn bg-transparent p-0",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},k={class:"dropdown-menu"},x=["onClick"];var U=(0,t.aZ)({__name:"UsersList",props:{users:{}},emits:["delete-user"],setup(e,{emit:s}){const a=e,o=s,n=e=>({...e,roles:e.roles.join(",")}),U=()=>a.users.filter((e=>!e.roles.includes("SuperAdmin"))).map(n),N=e=>{const s=a.users.find((s=>s.id===e.id));s&&o("delete-user",s)};return(e,s)=>{const a=(0,t.up)("vue-feather");return(0,t.wg)(),(0,t.iD)("div",u,[(0,t._)("div",i,[(0,t._)("div",d,[(0,t._)("table",m,[s[1]||(s[1]=(0,t._)("thead",null,[(0,t._)("tr",null,[(0,t._)("th",{class:"text-dark fw-medium pt-0 pb-2 fs-14 ps-0",scope:"col"}," Name "),(0,t._)("th",{class:"text-dark fw-medium pt-0 pb-2 fs-14",scope:"col"}," Email "),(0,t._)("th",{class:"text-dark fw-medium pt-0 pb-2 fs-14",scope:"col"}," Phone "),(0,t._)("th",{class:"text-dark fw-medium pt-0 pb-2 fs-14",scope:"col"}," Last Active Date "),(0,t._)("th",{class:"text-dark fw-medium pt-0 pb-2 fs-14",scope:"col"}," Roles "),(0,t._)("th",{class:"text-dark fw-medium pt-0 pb-2 fs-14",scope:"col"})])],-1)),(0,t._)("tbody",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(U(),(e=>((0,t.wg)(),(0,t.iD)("tr",{key:e.id},[(0,t._)("td",p,[(0,t._)("span",f,(0,r.zw)(e.fullName),1)]),(0,t._)("td",null,[(0,t._)("span",v,(0,r.zw)(e.email),1)]),(0,t._)("td",null,[(0,t._)("span",b,(0,r.zw)(e.phoneNumber),1)]),(0,t._)("td",null,[(0,t._)("span",w,(0,r.zw)((0,l.SU)(c.w)(e.lastActive)),1)]),(0,t._)("td",null,[(0,t._)("span",h,(0,r.zw)(e.roles),1)]),(0,t._)("td",_,[(0,t._)("div",g,[(0,t._)("button",y,[(0,t.Wm)(a,{type:"more-horizontal"})]),(0,t._)("ul",k,[(0,t._)("li",null,[(0,t._)("a",{class:"dropdown-item d-flex align-items-center",href:"javascript:;",onClick:s=>N(e)},[(0,t.Wm)(a,{type:"trash-2",size:"16",class:"me-2"}),s[0]||(s[0]=(0,t.Uk)(" Delete ",-1))],8,x)])])])])])))),128))])])])])])}}});const N=U;var E=N,L=a(3560),A=a(5543),C=a(2492),D=a.n(C),W=a(5469);const q={class:"container-fluid"},P={class:"inner-main-content"},R={class:"offcanvas offcanvas-custom offcanvas-end",tabindex:"-1",id:"offcanvasRight","aria-labelledby":"offcanvasRightLabel"},S={class:"offcanvas-header border-bottom"},F={class:"offcanvas-body"},V={key:0,id:"errorAlert",class:"alert alert-danger",role:"alert"},z={class:"row"},B={class:"col-lg-12"},H={class:"form-group mb-4"},J={class:"col-lg-12"},j={class:"form-group mb-4"},Z={class:"col-lg-12"},I={class:"form-group mb-4"},K={class:"col-lg-12"},Y={class:"form-group mb-4"};var Q=(0,t.aZ)({__name:"UsersListPage",setup(e){const{loadUsers:s,addNewUser:a,deleteUser:c}=(0,L.L)(),{users:u,error:i}=(0,A.Jk)((0,L.L)());u.value=[];const d=(0,l.qj)({email:"",fullName:"",phoneNumber:"",password:""}),m={name:"required|min:3|max:100|alpha_spaces",email:"required|min:3|max:100|email",phoneNumber:"required",password:"required|min:5|max:100|excluded:password"},p=(0,l.iH)(),f=()=>{d.email="",d.fullName="",d.phoneNumber="",d.password="",i.value=null,p.value?.resetForm()},v=(0,l.iH)(null),{handleSubmit:b}=(0,W.cI)(),w=b((async()=>{if(!p.value)return;const{valid:e}=await p.value.validate();if(!e)return void console.log("Form has validation errors");const s=await a(d);s.success&&(D().fire({toast:!0,position:"top-end",icon:"success",title:"User was added successfully.",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),p.value?.resetForm(),v.value?.click())})),h=e=>{D().fire({title:"Are you sure you want to delete the user?",icon:"warning",showCancelButton:!0,confirmButtonText:"Confirm",cancelButtonText:"Cancel"}).then((async s=>{if(s.isConfirmed){const s=await c(e);s.success&&D().fire({toast:!0,position:"top-end",icon:"success",title:"User is deleted successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}}))};return(0,t.bv)((()=>s())),(e,s)=>{const a=(0,t.up)("vee-field"),c=(0,t.up)("ErrorMessage"),b=(0,t.up)("vee-form");return(0,t.wg)(),(0,t.iD)("div",q,[(0,t._)("div",P,[s[11]||(s[11]=(0,t._)("div",{class:"card-title d-flex justify-content-between align-items-center mb-3"},[(0,t._)("h3",{class:"fw-medium fs-18 mb-0"},"User List")],-1)),(0,t._)("div",{class:"card-title d-flex justify-content-between align-items-center mb-3"},[s[4]||(s[4]=(0,t._)("div",null,null,-1)),(0,t._)("button",{class:"btn btn-primary default-btn",type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasRight","aria-controls":"offcanvasRight",onClick:f}," + Add New User ")]),(0,t.Wm)(E,{users:(0,l.SU)(u),onDeleteUser:h},null,8,["users"]),(0,t._)("div",R,[(0,t._)("div",S,[s[5]||(s[5]=(0,t._)("h5",{class:"offcanvas-title fs-18",id:"offcanvasRightLabel"}," New User ",-1)),(0,t._)("button",{type:"button",ref_key:"closeButtonRef",ref:v,class:"btn-close","data-bs-dismiss":"offcanvas","aria-label":"Close"},null,512)]),(0,t._)("div",F,[(0,l.SU)(i)&&Array.isArray((0,l.SU)(i))&&(0,l.SU)(i).length>0?((0,t.wg)(),(0,t.iD)("div",V,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)((0,l.SU)(i),((e,s)=>((0,t.wg)(),(0,t.iD)("div",{key:s},(0,r.zw)(e),1)))),128))])):(0,t.kq)("",!0),(0,t.Wm)(b,{ref_key:"formRef",ref:p,"validation-schema":m,onSubmit:(0,l.SU)(w)},{default:(0,t.w5)((()=>[(0,t._)("div",z,[(0,t._)("div",B,[(0,t._)("div",H,[s[6]||(s[6]=(0,t._)("label",{class:"label"},"Fullname",-1)),(0,t.Wm)(a,{type:"text",name:"name",class:"form-control",placeholder:"Enter Name",modelValue:d.fullName,"onUpdate:modelValue":s[0]||(s[0]=e=>d.fullName=e)},null,8,["modelValue"]),(0,t.Wm)(c,{class:"error-message",name:"name"})])]),(0,t._)("div",J,[(0,t._)("div",j,[s[7]||(s[7]=(0,t._)("label",{class:"label"},"Email Address",-1)),(0,t.Wm)(a,{type:"text",name:"email",class:"form-control",placeholder:"Enter Email",modelValue:d.email,"onUpdate:modelValue":s[1]||(s[1]=e=>d.email=e)},null,8,["modelValue"]),(0,t.Wm)(c,{class:"error-message",name:"email"})])]),(0,t._)("div",Z,[(0,t._)("div",I,[s[8]||(s[8]=(0,t._)("label",{class:"label"},"Phone",-1)),(0,t.Wm)(a,{type:"text",name:"phoneNumber",class:"form-control",placeholder:"Enter Phone",modelValue:d.phoneNumber,"onUpdate:modelValue":s[2]||(s[2]=e=>d.phoneNumber=e)},null,8,["modelValue"]),(0,t.Wm)(c,{class:"error-message",name:"phoneNumber"})])]),(0,t._)("div",K,[(0,t._)("div",Y,[s[9]||(s[9]=(0,t._)("label",{class:"label"},"Password",-1)),(0,t.Wm)(a,{name:"password",bails:!1},{default:(0,t.w5)((({field:e,errors:a})=>[(0,t.wy)((0,t._)("input",(0,t.dG)({type:"text",class:"form-control",placeholder:"Password"},e,{"onUpdate:modelValue":s[3]||(s[3]=e=>d.password=e)}),null,16),[[o.nr,d.password]]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a,(e=>((0,t.wg)(),(0,t.iD)("div",{class:"error-message",key:e},(0,r.zw)(e),1)))),128))])),_:1})])]),s[10]||(s[10]=(0,t._)("div",{class:"col-lg-12"},[(0,t._)("div",{class:"form-group"},[(0,t._)("button",{type:"submit",class:"default-btn"}," Register ")])],-1))])])),_:1},8,["onSubmit"])])]),(0,t.Wm)(n.Z)])])}}}),T=a(89);const G=(0,T.Z)(Q,[["__scopeId","data-v-627cbcc1"]]);var M=G}}]);
//# sourceMappingURL=211.69c26710.js.map